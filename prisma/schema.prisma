generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Deal {
  id          String    @id @default(uuid())
  clientName  String
  clientPhone String?
  notes       String?
  stage       DealStage @default(NEW_LEAD)
  dealType    DealType  @default(SALE)
  amount      Decimal?  @db.Decimal(12, 2)
  propertyId  String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  property    Property  @relation(fields: [propertyId], references: [id])
  
  // Rental management fields (only used when dealType = RENT)
  leaseStartDate  DateTime?
  leaseEndDate    DateTime?
  monthlyRent     Decimal?  @db.Decimal(12, 2)
  depositAmount   Decimal?  @db.Decimal(12, 2)
  nextPaymentDue  DateTime?
}

enum DealType {
  SALE
  RENT
}

model Project {
  id             String           @id @default(uuid())
  name           String
  type           PropertyCategory
  address        String
  city           String
  lat            Decimal          @db.Decimal(10, 8)
  lng            Decimal          @db.Decimal(11, 8)
  developer      String?
  completionYear Int?
  description    String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  totalUnits     Int?
  totalBuildings Int?
  totalFloors    Int?
  imageUrl       String?
  facilities     Facility[]
  modelAsset     ModelAsset?
  units          Property[]

  @@index([name])
  @@index([type])
  @@index([city])
  @@index([address])
}

model ModelAsset {
  id        String  @id @default(uuid())
  glbUrl    String
  placement Json    @default("{}")
  projectId String  @unique
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Facility {
  id        String  @id @default(uuid())
  name      String
  imageUrl  String?
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Property {
  id                    String              @id @default(uuid())
  title                 String
  description           String
  price                 Decimal?            @db.Decimal(12, 2)
  address               String
  city                  String
  state                 String
  zipCode               String
  category              PropertyCategory
  houseType             HouseType?
  projectName           String?
  floor                 Int?
  investmentType        InvestmentType?
  openForYears          Int?
  equipmentIncluded     EquipmentLevel?
  numberOfStaff         Int?
  monthlyRevenue        Decimal?            @db.Decimal(12, 2)
  license               Boolean?
  bedrooms              Int?
  bathrooms             Int?
  size                  Int
  petFriendly           Boolean?
  parking               Int?
  furnished             Boolean?
  garden                Boolean?
  pool                  Boolean?
  floors                Int?
  amenities             Json?
  status                PropertyStatus      @default(AVAILABLE)
  listingType           ListingType         @default(SALE)
  images                String[]
  featured              Boolean             @default(false)
  latitude              Decimal?            @db.Decimal(10, 8)
  longitude             Decimal?            @db.Decimal(11, 8)
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  lastVerifiedAt        DateTime            @default(now())
  ownerContactDetails   String?
  ownerContactMethod    ContactMethod?
  verificationSource    VerificationSource?
  rentPrice             Decimal?            @db.Decimal(12, 2)
  conferenceRoom        Boolean?
  area                  String?
  projectId             String?
  landZoneColor         LandZoneColor?
  coAgentCommissionRate Decimal?            @db.Decimal(5, 2)
  commissionAmount      Decimal?            @db.Decimal(12, 2)
  commissionRate        Decimal?            @db.Decimal(5, 2)
  deals                 Deal[]
  project               Project?            @relation(fields: [projectId], references: [id])

  @@index([city])
  @@index([status])
  @@index([featured])
  @@index([category])
  @@index([houseType])
  @@index([investmentType])
  @@index([landZoneColor])
  @@index([listingType])
}

model Contact {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String?
  message   String
  createdAt DateTime @default(now())

  @@index([createdAt])
}

model PropertySubmission {
  id           String           @id @default(uuid())
  contactName  String
  contactLine  String?
  contactPhone String?
  title        String
  description  String
  price        Decimal          @db.Decimal(12, 2)
  listingType  ListingType
  category     PropertyCategory
  address      String?
  city         String?
  state        String?
  commission   String?
  images       String[]
  status       String           @default("PENDING")
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
}

model Post {
  id         String       @id @default(uuid())
  title      String
  excerpt    String?
  content    String
  category   PostCategory
  coverImage String?
  published  Boolean      @default(false)
  authorName String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@index([category])
  @@index([published])
}

model AgentProfile {
  id        String   @id @default(uuid())
  name      String
  email     String?
  phone     String?
  lineId    String?
  imageUrl  String?
  languages String[]
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  role      UserRole @default(AGENT)
}

enum PropertyCategory {
  HOUSE
  CONDO
  INVESTMENT
  LAND
}

enum HouseType {
  SINGLE_HOUSE
  POOL_VILLA
  TOWNHOUSE
  SHOPHOUSE
}

enum InvestmentType {
  HOTEL
  CLUB_BAR
  MASSAGE
  RESTAURANT
  WELLNESS
}

enum LandZoneColor {
  RED
  ORANGE
  YELLOW
  BROWN
  PURPLE
  GREEN
}

enum EquipmentLevel {
  FULLY
  PARTIAL
  JUST_STRUCTURE
}

enum PropertyStatus {
  AVAILABLE
  PENDING
  SOLD
  RENTED
  EXPIRED
}

enum ListingType {
  SALE
  RENT
  BOTH
}

enum VerificationSource {
  MANUAL
  OWNER
  SYSTEM
}

enum ContactMethod {
  LINE
  EMAIL
  PHONE
}

enum DealStage {
  NEW_LEAD
  VIEWING
  OFFER
  CONTRACT
  CLOSED
}

enum UserRole {
  SUPER_ADMIN
  PLATFORM_AGENT
  AGENT
}

enum PostCategory {
  MARKET_TREND
  INVESTMENT
  LEGAL
  NEWS
}
